# Методы создания процессов в различных операционных системах. Структуры данных о процессах.
## Методы создания процессов в различных операционных системах
### В Unix-подобных системах (Linux, BSD)
- **fork()**  
  - Создает точную копию родительского процесса (копирует адресное пространство, файловые дескрипторы, контекст).  
  - Использует механизм **Copy-on-Write (CoW)** для оптимизации (память копируется только при изменении).  
  - После `fork()` дочерний процесс обычно вызывает `exec()` для загрузки новой программы.  
- **exec()** (семейство функций: `execl`, `execv`, `execvp` и др.)  
  - Заменяет текущий образ процесса новым исполняемым файлом.  
  - Сохраняет PID, но сбрасывает память и открытые ресурсы (кроме явно унаследованных).  
- **clone()**  
  - Более гибкий аналог `fork()`, позволяет настраивать, какие ресурсы разделять (используется для создания потоков).  
  - Может создавать "сестринские" потоки (обход дерева процессов).  
### В Windows
- **CreateProcess()**  
  - Создает новый процесс и загружает указанный исполняемый файл.  
  - Возвращает handles (дескрипторы) для управления процессом и его основным потоком.  
  - Нет аналога `fork()` – процессы создаются "с нуля".  

- **Jobs (Задания)**  
  - Группы процессов с общими ограничениями (CPU, память, права).  
  - Аналог Linux cgroups, но на уровне объектов ядра Windows.  
### Различия подходов

|                  | *Unix/Linux*                | *Windows*                 |
| ---------------- | ------------------------- | ----------------------- |
| **Наследование** | Через `fork()` + `exec()` | Через `CreateProcess()` |
| **Потоки**       | `clone()` с настройкой    | `CreateThread()`        |
| **Группы**       | cgroups                   | Job Objects             |
| **Изоляция**     | PID namespaces, cgroups   | Job Objects, Sessions   |

## Структуры данных о процессах

### Linux
- **task_struct** (в ядре Linux)  
  - Полное описание процесса:  
    - PID, PPID (родительский PID)  
    - Указатель на память (`mm_struct`)  
    - Список открытых файлов (`files_struct`)  
    - Состояние (running, zombie, stopped)  
    - Приоритет и политика планирования  
    - Информация о потоках (если есть)  
- **Дерево процессов**  
  - Все процессы образуют иерархию:  
    - Корень – `init`/`systemd` (PID=1) для пользовательских процессов.  
    - `kthreadd` (PID=2) – для потоков ядра.
![](../img/Pasted%20image%2020250622132223.png)
- **Таблица процессов**  
  - Статический массив (размер зависит от ядра, обычно до 2^16 записей).  
  - Zombie-процессы остаются в таблице до вызова `wait()` родителем.
### Windows
- **EPROCESS** (в ядре Windows)  
  - Аналог `task_struct`:  
    - Уникальный PID и дескрипторы.  
    - Ссылка на родительский процесс.  
    - Список потоков (`ETHREAD`).  
    - Квотирование ресурсов (память, CPU).
- **Дерево процессов**  
  - Также иерархическое, но с возможностью "переопределения" родителя. 
  - Корень – `System` (PID=4).  
- **Диспетчер процессов**  
  - Управляет созданием/удалением через объекты ядра.  
  - Нет зомби-процессов – при завершении ресурсы освобождаются сразу.  
### Ключевые различия структур

|                       | *Linux*                       | *Windows*                |
| --------------------- | --------------------------- | ---------------------- |
| **Базовая структура** | `task_struct`               | `EPROCESS` + `ETHREAD` |
| **Потоки**            | Учитываются в `task_struct` | Отдельная `ETHREAD`    |
| **Зомби**             | Есть (ждут `wait()`)        | Нет (автоочистка)      |
| **Родитель**          | Жесткая иерархия            | Можно переопределить   |
