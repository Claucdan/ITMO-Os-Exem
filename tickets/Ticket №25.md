# Принципы управления памятью вычислительной системы. Виртуальная память и преобразование адресов.
## Принципы управления памятью вычислительной системы
Управление памятью в вычислительной системе основывается на следующих ключевых принципах:
1. **Разделение памяти между процессами**:
   - Каждый процесс имеет собственное адресное пространство, изолированное от других процессов. Это обеспечивает защиту данных и предотвращает нежелательные взаимодействия между процессами.
   - Для реализации изоляции используется механизм виртуальной памяти.
2. **Оптимизация использования памяти**:
   - Память распределяется динамически в зависимости от потребностей процессов. Это позволяет эффективно использовать ограниченные ресурсы оперативной памяти.
   - Используются стратегии подкачки (swapping) и страничного обмена (paging) для перемещения данных между оперативной памятью и внешним хранилищем (например, разделом подкачки).
3. **Виртуализация памяти**:
   - Виртуальная память создает иллюзию, что каждый процесс имеет доступ к большому непрерывному адресному пространству, даже если физическая память ограничена.
   - Это достигается за счет комбинации оперативной памяти и внешнего хранилища (например, файла подкачки или раздела подкачки).
4. **Динамическое преобразование адресов**:
   - Виртуальные адреса, используемые процессами, преобразуются в физические адреса в оперативной памяти. Это преобразование выполняется аппаратно (с помощью MMU — Memory Management Unit) и программно (с участием операционной системы).
5. **Защита памяти**:
   - ОС контролирует доступ процессов к памяти, предотвращая попытки чтения или записи в чужие адресные пространства. Это реализуется через механизмы защиты, такие как биты доступа в таблицах страниц.
## Виртуальная память
### Определение
Технология, которая позволяет:
- Расширить доступное адресное пространство за счет использования внешнего хранилища (например, жесткого диска).
- Обеспечить изоляцию процессов, предоставляя каждому из них собственное виртуальное адресное пространство.
- Оптимизировать использование оперативной памяти, загружая в нее только активно используемые данные.
### Ключевые аспекты виртуальной памяти:
1. **Страничная организация**:
   - Память делится на страницы фиксированного размера (например, 4 Кб). Виртуальные страницы отображаются на физические страницы в оперативной памяти или на диске.
   - Таблица страниц хранит информацию о соответствии виртуальных страниц физическим.
2. **Подкачка (swapping)**:
   - Если процессу требуется страница, которой нет в оперативной памяти, происходит страничное прерывание (page fault). ОС загружает нужную страницу с диска в оперативную память, возможно, выгружая другую страницу.
3. **Кэширование**:
   - Для ускорения преобразования адресов используется TLB (Translation Lookaside Buffer) — кэш, хранящий недавно использованные соответствия виртуальных и физических адресов.
### Преобразование адресов
Преобразование виртуальных адресов в физические включает следующие шаги:
1. **Разделение адреса**:
   - Виртуальный адрес делится на номер страницы и смещение внутри страницы. Например, на 32-битной системе с размером страницы 4 Кб:
     - Старшие 20 бит — номер страницы.
     - Младшие 12 бит — смещение.
2. **Поиск в таблице страниц**:
   - По номеру страницы находится соответствующая запись в таблице страниц процесса. Запись содержит физический адрес страницы и флаги (например, бит присутствия, бит доступа).
3. **Проверка флагов**:
   - Если страница находится в оперативной памяти (бит присутствия установлен), физический адрес формируется как:  
$$
\text{Физический адрес} = \text{Адрес страницы} \times \text{Размер страницы} + \text{Смещение}.
$$
   - Если страницы нет в памяти, возникает страничное прерывание, и ОС загружает ее с диска.

4. **Использование TLB**:
   - Чтобы избежать частых обращений к таблице страниц, преобразование адресов кэшируется в TLB.