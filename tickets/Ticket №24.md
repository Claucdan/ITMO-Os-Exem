# Тупики. Условия возникновения и методы борьбы с тупиками.
## Условия возникновения тупиков (deadlocks)
Тупики возникают при одновременном выполнении следующих четырех условий:
1. **Взаимное исключение (Mutual Exclusion)**  
	Ресурс может использоваться только одним процессом в данный момент времени. Если ресурс занят, другие процессы должны ждать его освобождения.
2. **Удержание и ожидание (Hold and Wait)**  
	Процесс удерживает хотя бы один ресурс и при этом запрашивает дополнительные ресурсы, которые в данный момент заняты другими процессами.
3. **Неперераспределяемость (No Preemption)**  
	Ресурсы нельзя принудительно отобрать у процесса. Они могут быть освобождены только добровольно, после завершения их использования.
4. **Круговое ожидание (Circular Wait)**  
	Существует замкнутая цепочка процессов, где каждый процесс ждет ресурс, удерживаемый следующим процессом в цепочке. Например:
	   - Процесс P_1 ждет ресурс R_2, удерживаемый процессом P_2.
	   - Процесс P_2 ждет ресурс R_1, удерживаемый процессом P_1.
## Методы борьбы с тупиками
### Игнорирование тупиков
#### Описание 
Система не предпринимает никаких действий для предотвращения или обнаружения тупиков.  
#### Применение
Подходит для систем, где тупики возникают крайне редко, а затраты на их обработку превышают возможные потери.  
#### Пример
Многие ОС (например, Windows, Linux) используют этот подход для некоторых типов ресурсов.
### Предотвращение тупиков
Нарушение одного из условий возникновения тупиков:
#### Нарушение взаимного исключения**:  
  Некоторые ресурсы можно сделать разделяемыми (например, буферизация вывода на принтер). Однако это применимо не ко всем ресурсам (например, критические секции кода).
#### Нарушение удержания и ожидания**:  
  Требовать, чтобы процесс запрашивал все необходимые ресурсы сразу перед началом выполнения. Если ресурсы недоступны, процесс не стартует.  
  
  **Недостаток**: Неэффективное использование ресурсов, так как процесс может удерживать ресурсы, которые ему не нужны в данный момент.
#### Нарушение неперераспределяемости**:  
  Разрешить ОС принудительно забирать ресурсы у процессов. Например, если высокоприоритетный процесс требует ресурс, занятый низкоприоритетным, ресурс может быть временно изъят.  
  **Недостаток**: Сложность реализации и потенциальные потери данных.

#### Нарушение кругового ожидания  
- Упорядочить ресурсы и требовать, чтобы процессы запрашивали их в строгом порядке.  
- Например, если ресурсы пронумерованы, процесс не может запросить ресурс с меньшим номером, если уже удерживает ресурс с большим номером.  
**Пример**: В задаче об обедающих философах можно потребовать, чтобы вилки всегда запрашивались в порядке возрастания их номеров.

### Обнаружение и восстановление
#### Обнаружение тупиков**:  
  - Построение графа ожидания ресурсов и поиск циклов.  
  - Использование алгоритмов, таких как алгоритм банкира (для проверки безопасного состояния).  
  **Недостаток**: Высокие накладные расходы, особенно в системах с большим количеством процессов и ресурсов.

#### Восстановление после тупика**:  
  - **Прекращение процессов**: Завершить один или несколько процессов, участвующих в тупике.  
  - **Откат ресурсов**: Откатить состояние процессов до точки, предшествующей тупику, и повторить выполнение.  
  - **Ручное вмешательство**: В некоторых системах администратор может вручную завершить процессы или перераспределить ресурсы.
## Примеры из лекции
1. **Проблема обедующих философов**:  
   - Если все философы одновременно возьмут левую вилку и будут ждать правую, возникнет тупик.  
   - **Решение**: Упорядочить запросы вилок (например, по номеру) или ввести "официанта" (арбитра), который контролирует доступ к ресурсам.
2. **Проблема читателей и писателей**:  
   - Если читатели постоянно занимают ресурс, писатели могут "голодать".  
   - **Решение**: Группировать запросы на чтение и обеспечивать приоритет записи при необходимости.